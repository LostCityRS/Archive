generator kysely {
    provider = "prisma-kysely"

    output       = "../src/db"
    fileName     = "types.ts"
    enumFileName = "enums.ts"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model game {
    id Int @id @default(autoincrement())

    name         String @unique
    display_name String

    newspost_url String?

    @@index([name])
}

// ----

model data_versioned {
    game_id Int

    archive Int   @db.UnsignedTinyInt // archives are 0-255
    // "group" and "file" are considered interchangeable terms
    group   Int   @db.UnsignedInt // groups can be >65535
    version Int   @db.UnsignedInt // versions can be >65535 (i.e. timestamps)
    crc     Int
    bytes   Bytes @db.MediumBlob
    len     Int   @db.UnsignedInt

    @@id([game_id, archive, group, version, crc])
}

model data_raw {
    game_id Int

    name  String
    crc   Int
    bytes Bytes  @db.MediumBlob
    len   Int    @db.UnsignedInt

    @@id([game_id, name, crc])
}

model cache {
    id      Int @id @default(autoincrement())
    game_id Int

    build       String
    timestamp   DateTime?
    newspost    String?
    description String?

    versioned Boolean

    // recalculated after imports
    missing Int @default(0)
    total   Int @default(0)
    len     Int @default(0)

    @@index([game_id])
}

// internal source tracking
model cache_source {
    id       Int @id @default(autoincrement())
    cache_id Int

    timestamp   DateTime?
    attribution String?
    description String?
    url         String?

    @@index([cache_id])
}

model cache_versioned {
    cache_id Int

    archive Int
    group   Int
    version Int
    crc     Int

    @@id([cache_id, archive, group, version, crc])
    @@index([cache_id])
}

model cache_raw {
    cache_id Int

    name String
    crc  Int

    @@id([cache_id, name, crc])
    @@index([cache_id])
}

// ----

model client {
    id      Int @id @default(autoincrement())
    game_id Int

    build       String
    timestamp   DateTime?
    newspost    String?
    description String?

    name  String
    bytes Bytes  @db.LongBlob
    len   Int

    @@index([game_id])
}

// internal source tracking
model client_source {
    id        Int @id @default(autoincrement())
    client_id Int

    timestamp   DateTime?
    attribution String?
    description String?
    url         String?

    @@index([client_id])
}

model cache_client {
    cache_id  Int
    client_id Int

    @@id([cache_id, client_id])
}
