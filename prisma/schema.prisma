generator kysely {
    provider = "prisma-kysely"

    output       = "../src/db"
    fileName     = "types.ts"
    enumFileName = "enums.ts"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model game {
    id Int @id @default(autoincrement())

    name         String
    display_name String

    parent_game Int?
    newspost_url String?
}

model cache {
    id Int @id @default(autoincrement())

    game_id   Int
    build     String
    timestamp DateTime?
    newspost  String?

    js5      Boolean
    ondemand Boolean
    jag      Boolean
}

model submission {
    uuid        String  @id
    attribution String?
    ip          String
    user_agent  String
}

// 2006+
model data_js5 {
    game_id Int
    archive Int   @db.UnsignedTinyInt // archives are 0-255
    group   Int   @db.UnsignedInt // groups can be >65535
    version Int   @db.UnsignedInt // versions can be >65535 (timestamps)
    crc     Int
    bytes   Bytes @db.MediumBlob
    len     Int

    @@id([game_id, archive, group, version, crc])
    @@index([game_id, archive]) // fast lookup by game,archive
    @@index([game_id, archive, group]) // fast lookup by game,archive,group
    @@index([game_id, archive, group, version]) // fast lookup by game,archive,group,version
    @@index([game_id, archive, crc]) // fast lookup by game,archive,crc
}

model cache_js5 {
    cache_id Int
    archive  Int
    group    Int
    version  Int
    crc      Int

    @@id([cache_id, archive, group])
}

// 2004-2006
model data_ondemand {
    game_id Int
    archive Int   @db.UnsignedTinyInt // archives are 0-255
    file    Int   @db.UnsignedSmallInt // files are 0-65535
    version Int   @db.UnsignedSmallInt // versions are 0-65535
    crc     Int
    bytes   Bytes @db.MediumBlob
    len     Int

    @@id([game_id, archive, file, version, crc])
    @@index([game_id, archive]) // fast lookup by game,archive
    @@index([game_id, archive, file]) // fast lookup by game,archive,file
    @@index([game_id, archive, file, version]) // fast lookup by game,archive,file,version
    @@index([game_id, archive, crc]) // fast lookup by game,archive,crc
}

model cache_ondemand {
    cache_id  Int
    archive   Int
    file      Int
    version   Int
    crc       Int
    essential Boolean

    @@id([cache_id, archive, file])
    @@index([cache_id, archive, essential]) // fast lookup by cache_id,archive,essential
}

// 2001-2004
model data_jag {
    game_id Int
    name    String
    crc     Int
    bytes   Bytes  @db.MediumBlob
    len     Int

    @@id([game_id, name, crc])
    @@index([game_id, name]) // fast lookup by game,name
}

model cache_jag {
    cache_id Int
    name     String
    crc      Int

    @@id([cache_id, name, crc])
}
